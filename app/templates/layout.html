
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <meta name="description" content="">
    <meta name="author" content="">

    <title>GoSlow - Bootstrap 4 Alpha</title>

    <!-- Bootstrap core CSS -->
    {% assets "common_css" %}
      <link href="{{ ASSET_URL }}" rel="stylesheet">
    {% endassets %}

    <style type="text/css">

      .navbar {
        margin-bottom: 20px;
        padding-left: 0;
        padding-right: 0;
      }

      .checkbox {
        margin-bottom: 0;
      }
    </style>
  </head>

  <body>

    <div class="container">

          <header class="navbar navbar-light navbar-static-top bd-navbar" role="banner">

            <div class="clearfix">
              <button class="navbar-toggler pull-xs-right hidden-sm-up collapsed" type="button" data-toggle="collapse" data-target="#bd-main-nav" aria-expanded="false">
                â˜°
              </button>
              <a class="navbar-brand hidden-sm-up" href="/">
                GoSlow
              </a>
            </div>
            <div class="navbar-toggleable-xs collapse" id="bd-main-nav" aria-expanded="false" style="height: 0px;">
              <nav class="nav navbar-nav">
                <a class="nav-item nav-link " href="/">GoSlow</a>
                <a class="nav-item nav-link" href="/refund">Refund My Trip</a>
                <a class="nav-item nav-link " href="/word_fund">Word Fun</a>
              </nav>
            </div>
          </header>
      <!-- Main component for a primary marketing message or call to action -->
    {% block body %}{% endblock %}
    </div> <!-- /container -->


        <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.10.6/moment.min.js"></script>
    {% assets "common_js" %}
      <script type="text/javascript" src="{{ ASSET_URL }}"></script>
    {% endassets %}

    <script>
      $(document).ready(function(){
        var depart_station, arrival_station, depart_time, travel_dow, travel_date;

        $('#prestocard_number').mask('0000 0000 0000 00000');

        var picker = new Pikaday({
          field: document.getElementById('datepicker'),
          minDate: moment().subtract(7, 'days').toDate(),
          maxDate: moment().toDate(),
          onSelect: function(){
            travel_dow = moment(this.getDate()).unix();
            travel_date = moment(this.getDate()).date()
            $('#depart_time, #arrival_station').empty();
            $('#depart_station').change();
          }
        });

        picker.setDate(moment().toDate());

        $('#refund-form').on('change', '#depart_station',function(){
          $('#arrival_station, #depart_time').empty();
          var $this = $(this);
          if($(this).val() != ""){
            $.get('/api/go/stoptimes/' + $('#depart_station').val() + '/' + travel_dow, function(r){
              $('#depart_time').append('<option value="" selected disabled>Select Departure Time</option>');
              $.each(r.times, function(i, e){
                $('#depart_time').append('<option value="' + e.departure_time + '">' + e.departure_time.slice(0,-3) + '</option>');
              });
            });
            depart_station = $this.val();
          }
        });

        $('#refund-form').on('change', '#depart_time',function(){
          $('#arrival_station').empty();
          $.ajax({
            url: '/api/go/stops',
            method: 'POST',
            data: {
              'from_station': depart_station,
              'travel_date': travel_dow,
              'travel_time': $('#depart_time').val()
            },
            success: function(r){
              $.each(r.stops, function(i, e){
                $('#arrival_station').append('<option value="' + e.stop_id + '">' + e.stop_name + '</option>');
              });
            }
          });          
        });
/*
        $('#refund-form').on('submit', function(e){
          var $this = $(this);
          e.preventDefault();

          var deptime = $('#depart_time').val().split('-')[2].indexOf('x') == -1 ? $('#depart_time').val().split('-')[2] : $('#depart_time').val().split('-')[2].replace(/([A-Za-z])\w+/g,'');
          
          $.ajax({
            url: '/api/go/refund',
            method: 'POST',
            data: {
              'pc_number': $('#prestocard_number').val().replace(/\s+/g, ''),
              'email': $('#email').val(),
              'travel_date': travel_date,
              'from_station': $('#depart_station').val(),
              'to_station': $('#arrival_station').val(),
              'travel_time': deptime
            },
            success: function(r){
              console.log(r);
            }
          });
        });
*/
      });
    </script>
  </body>
</html>
